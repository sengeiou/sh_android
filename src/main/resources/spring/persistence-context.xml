<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"

	xmlns="http://www.springframework.org/schema/beans" 
	xmlns:p="http://www.springframework.org/schema/p"
	xmlns:util="http://www.springframework.org/schema/util"  

	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
						http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-4.0.xsd">

	<description>
        Fichero de configuración de la persistencia en Spring.
    </description>
    
	<!-- Configuración del gestor de transacciones. -->
	<bean id="transactionManager"
		class="org.springframework.jdbc.datasource.DataSourceTransactionManager"
		p:dataSource-ref="dataSource">
		<description>Fuente de datos a publicar.</description>
	</bean>

	<util:properties id="props" location="classpath:/properties/datasource.properties"/>
		
	<!-- HikariCP configuration -->
	<bean id="hikariConfig" class="com.zaxxer.hikari.HikariConfig">
		<property name="poolName" value="${jdbc.pool.poolName}" />  
		<property name="acquireIncrement" value="${jdbc.pool.acquireIncrement}" />
		<property name="acquireRetries" value="${jdbc.pool.acquireRetries}" />
		<property name="acquireRetryDelay" value="${jdbc.pool.acquireRetryDelay}" />
		<property name="autoCommit" value="${jdbc.pool.autoCommit}" />
		<property name="connectionInitSql" value="${jdbc.pool.connectionInitSql}" />
		<property name="connectionTestQuery" value="${jdbc.pool.connectionTestQuery}" />
		<property name="jdbc4ConnectionTest" value="${jdbc.pool.jdbc4ConnectionTest}" />
		<property name="connectionTimeout" value="${jdbc.pool.connectionTimeout}" />
		<property name="idleTimeout" value="${jdbc.pool.idleTimeout}" />
		<property name="leakDetectionThreshold" value="${jdbc.pool.leakDetectionThreshold}" />
		<property name="maxLifetime" value="${jdbc.pool.maxLifetime}" />
		<property name="maximumPoolSize" value="${jdbc.pool.maximumPoolSize}" />  
		<property name="minimumPoolSize" value="${jdbc.pool.minimumPoolSize}" />
		<!-- 
			El hirakiCP tiene un bug en la conversión de tipos.
			<property name="transactionIsolation" value="${jdbc.pool.transactionIsolation}" />
		-->
		<property name="useInstrumentation" value="${jdbc.pool.useInstrumentation}" />

		<property name="dataSourceClassName" value="${jdbc.pool.dataSourceClassName}" />  
		<property name="dataSourceProperties" ref="props" />  
	</bean> 
	
	<bean id="dataSource" class="com.zaxxer.hikari.HikariDataSource">  
		<constructor-arg ref="hikariConfig" />  
	</bean>  
	
</beans>